<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dobby ğŸŒ Multi-Lingual Translator & Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      position: relative;
      min-height: 100vh;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('senti.jpg') repeat; /* tiled background */
      background-size: auto;
      filter: blur(10px);
      z-index: -1;
    }

    .chat-bubble {
      border-radius: 1rem;
      padding: 0.75rem;
      max-width: 70%;
      word-wrap: break-word;
      position: relative;
    }

    .user-bubble {
      background: #6366f1;
      color: white;
      align-self: flex-end;
      margin-left: auto;
    }

    .assistant-bubble {
      background: #e0e7ff;
      color: #1e3a8a;
      align-self: flex-start;
      margin-right: auto;
    }

    .copy-btn {
      position: absolute;
      bottom: 5px;
      right: 10px;
      background: #4f46e5;
      color: white;
      font-size: 0.65rem;
      padding: 2px 6px;
      border-radius: 0.5rem;
      cursor: pointer;
      opacity: 0.8;
    }

    .copy-btn:hover {
      opacity: 1;
    }

    .card {
      background: rgba(255, 255, 255, 0.85);
      padding: 1rem;
      border-radius: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      max-height: 600px;
    }

    .block-title {
      font-weight: bold;
      font-size: 1.2rem;
      color: #4f46e5;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    footer {
      text-align: center;
      margin-top: 1rem;
      color: #1e3a8a;
      font-weight: bold;
    }
  </style>
</head>
<body class="flex flex-col p-4 bg-gray-100">

  <!-- Three-column layout with flex-grow ratios -->
  <div class="flex flex-col md:flex-row gap-4 w-full">

    <!-- Translator / Input Block -->
    <div class="flex-[3] card">
      <div class="block-title">ğŸŒ Multi-Lingual Translator With Answers </div>

      <div class="mb-3">
        <label class="block mb-1 font-semibold">Select Output Language:</label>
        <select id="language" class="w-full border p-2 rounded shadow-sm">
          <option value="en">English</option>
          <option value="hi">Hindi</option>
          <option value="kn">Kannada</option>
          <option value="ta">Tamil</option>
            <option value="te">Telugu</option>
          <option value="vi">Vietnamese</option>
          <option value="bn">Bangla</option>
          <option value="ru">Russian</option>
          <option value="es">Spanish</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="block mb-1 font-semibold">ğŸ™ï¸ Speak or Type Your Question:</label>
        <textarea id="userInput" class="w-full border p-2 rounded-lg shadow-sm h-40 resize-none" placeholder="Ask Dobby anything..."></textarea>
      </div>

      <div class="flex gap-3">
        <button onclick="startListening()" class="flex-1 py-2 bg-indigo-100 text-indigo-700 font-semibold rounded-lg hover:bg-indigo-200 shadow">ğŸ¤ Speak</button>
        <button onclick="askDobby()" class="flex-1 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 shadow">Ask Dobby</button>
      </div>
    </div>

    <!-- Chat Block -->
    <div class="flex-[2] card">
      <div class="block-title">ğŸ’¬ Chat</div>
      <div id="chatContainer" class="flex flex-col gap-2 overflow-y-auto h-[480px]">
        <!-- Chat messages will appear here -->
      </div>
    </div>

    <!-- Guide / Instructions Block -->
    <div class="flex-[1] card">
      <div class="block-title">ğŸ›ˆ Guide</div>
      <ul class="list-disc list-inside space-y-1 text-gray-700 text-sm">
        <li>Select the language you want Dobby to respond in.</li>
        <li>Type your question or click ğŸ¤ to speak your question.</li>
        <li>Click â€œAsk Dobbyâ€ to get a concise, shareable answer.</li>
        <li>Your question and Dobbyâ€™s answer appear in the chat.</li>
        <li>Click â€œCopyâ€ on Dobbyâ€™s answer to quickly share it.</li>
      </ul>
    </div>

  </div>

  <!-- Footer -->
<!-- Footer bar -->
<footer class="fixed bottom-0 left-0 w-full bg-white/80 backdrop-blur-md text-gray-800 text-center py-2 font-semibold shadow-md">
  Developed & Designed by Naina
</footer>


  <script>
    const DOBBY_API_KEY = "fw_3ZWjAcC9oUwQtoRxFhqDpn2M"; 
    const DOBBY_MODEL = "accounts/sentientfoundation-serverless/models/dobby-mini-unhinged-plus-llama-3-1-8b";
    const DOBBY_API_URL = "https://api.fireworks.ai/inference/v1/chat/completions";

    async function translateText(text, targetLang) {
      try {
        const resp = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLang}&dt=t&q=${encodeURIComponent(text)}`);
        const data = await resp.json();
        return data[0].map(x => x[0]).join('');
      } catch (e) {
        return "âŒ Translation failed.";
      }
    }

    async function askDobby() {
      const lang = document.getElementById("language").value;
      const userText = document.getElementById("userInput").value.trim();
      const chatContainer = document.getElementById("chatContainer");

      if (!userText) return alert("Please enter or speak a question!");

      const userBubble = document.createElement("div");
      userBubble.classList.add("chat-bubble", "user-bubble");
      userBubble.textContent = userText;
      chatContainer.appendChild(userBubble);
      chatContainer.scrollTop = chatContainer.scrollHeight;

      const translatedQuestion = await translateText(userText, lang);
      const transBubble = document.createElement("div");
      transBubble.classList.add("chat-bubble", "assistant-bubble");
      transBubble.textContent = "Translated Question: " + translatedQuestion;
      chatContainer.appendChild(transBubble);
      chatContainer.scrollTop = chatContainer.scrollHeight;

      let responseText = "";
      try {
        const resp = await fetch(DOBBY_API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + DOBBY_API_KEY
          },
          body: JSON.stringify({
            model: DOBBY_MODEL,
            messages: [
              { role: "system", content: `You are a helpful assistant. Respond in ${lang} as a concise answer that a person can directly say or share.` },
              { role: "user", content: translatedQuestion }
            ],
            max_tokens: 400
          })
        });
        const data = await resp.json();
        responseText = data.choices?.[0]?.message?.content?.trim() || "No response.";
      } catch (err) {
        responseText = "âš ï¸ API Error: " + err;
      }

      const respBubble = document.createElement("div");
      respBubble.classList.add("chat-bubble", "assistant-bubble");
      respBubble.textContent = responseText;

      const copyBtn = document.createElement("span");
      copyBtn.textContent = "Copy";
      copyBtn.classList.add("copy-btn");
      copyBtn.onclick = () => {
        navigator.clipboard.writeText(responseText);
        copyBtn.textContent = "Copied!";
        setTimeout(() => copyBtn.textContent = "Copy", 1000);
      };

      respBubble.appendChild(copyBtn);
      chatContainer.appendChild(respBubble);
      chatContainer.scrollTop = chatContainer.scrollHeight;

      document.getElementById("userInput").value = "";
    }

    function startListening() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) return alert("Speech recognition not supported in this browser.");
      const recognition = new SpeechRecognition();
      recognition.lang = "auto";
      recognition.interimResults = false;
      recognition.start();
      recognition.onresult = (e) => {
        document.getElementById("userInput").value = e.results[0][0].transcript;
      };
    }
  </script>
</body>
</html>
